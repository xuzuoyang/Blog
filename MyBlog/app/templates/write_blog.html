{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Detail Page{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='css/bootstrap-tagsinput.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container content">
  <!-- <div class="row"> -->

    <div class="blog-main">

      <div class="blog">
        <form class="form" method="">
            <h2>New Blog</h2>
            <label for="tags">Title</label>
            <div class="form-group">
                <input class="form-control" id="title" type="text">
            </div>
            <label for="tags">Category</label>
            <div class="form-group">
                <select class="form-control" id="category">
                    <option value="tech">Tech</option>
                    <option value="life">Life</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <label for="tags">Content</label>
            <div class="form-group">
                <textarea class="form-control" id="content" rows="20"></textarea>
            </div>
            <!-- <label for="tags">Tags</label>
            <div class="form-group">

                <input class="form-control" id="tags" type="text" value="" data-role="tagsinput" style="width:100%;">
            </div> -->
            <div class="form-group">
                <input id="submit" class="btn btn-primary" type="button" value="Submit">
            </div>
        </form>
      </div>
    </div>

  <!-- </div> -->
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/bootstrap-tagsinput.js') }}"></script>
<script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
<script>
// 编辑博客时填充表单内容
form = {{ form | safe }};
if(form.title){
    $('#title').val(form.title);
    $('#category').prop('selectedIndex', form.category-1);
    $('#content').text(form.content);
}

tinymce.init({
    //选择class为content的标签作为编辑器
    selector: '#content',
    //方向从左到右
    directionality:'ltr',
    //高度为400
    height:400,
    //工具栏上面的补丁按钮
    plugins: [
            'advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker',
            'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
            'save table contextmenu directionality emoticons template paste textcolor',
            'codesample',
    ],
    //工具栏的补丁按钮
     toolbar: 'insertfile undo redo | \
     styleselect | \
     bold italic | \
     alignleft aligncenter alignright alignjustify | \
     bullist numlist outdent indent | \
     link image | \
     print preview media fullpage | \
     forecolor backcolor emoticons |\
     codesample fontsizeselect fullscreen',
    //字体大小
    fontsize_formats: '10pt 12pt 14pt 18pt 24pt 36pt',
    //按tab不换行
    nonbreaking_force_tab: true,
});

// tinymce.get('content').setContent('');

$(function() {
    $('#submit').click(function() {
        title = $('#title').val();
        category = $('#category').val();
        content = tinymce.get('content').getContent();
        data = {title: title, category: category, content: content};
        alert(form.url);
        $.ajax({
          type: "POST",
          url: form.url,
          data: data,
          success: function (data, textStatus) {
            // alert(textStatus);
            if (data.url) {
                // alert(data.url);
                window.location = data.url;
            } else {
                window.location = "/";
            }
          },
          error: function (xhr, error) {
            alert(xhr.responseText);
            alert(xhr.status);
          },
          dataType: "json"
        });
    });
});
</script>
{% endblock %}
